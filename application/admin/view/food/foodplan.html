{extend name="public/base"/}
{block name="style"}
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/libs/bootstrap-editable.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/foodsell.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/checkbox1.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/extraCss.css">
<script>
$(function(){
	$('#page-wrapper').css('paddingTop','20px');
})
</script>
<!-- datepicker statr -->
<link href="__PUBLIC__/plugs/datepicker/css/foundation-datepicker.min.css" rel="stylesheet" type="text/css">

<script src="__PUBLIC__/plugs/datepicker/js/foundation-datepicker.js"></script>
<script src="__PUBLIC__/plugs/datepicker/js/foundation-datepicker.zh-CN.js"></script>
<link href="__PUBLIC__/plugs/ueditor/themes/default/css/ueditor.min.css" rel="stylesheet" type="text/css">
<!-- 配置文件 -->
<script type="text/javascript" src="__PUBLIC__/plugs/ueditor/ueditor.config.js"></script>
<!-- 编辑器源码文件 -->
<script type="text/javascript" src="__PUBLIC__/plugs/ueditor/ueditor.all.min.js"></script>
<style>
.edit{color:#03a9f4;float:right;}
.edit:hover{text-decoration:underline;cursor:pointer;}
.cookCon{
	border-radius: 3px;
    box-shadow: none;
    font-size: 13px;
    display: inline-block;
    width: 100%;
    min-height: 34px;
    padding: 3px 6px;
    font-size: 14px;
    line-height: 1.42857143;
    color: #555;
    background-color: #fff;
    border: 1px solid #ccc;
}
</style>
{/block}
{block name="header"}
<div class="header cl">
	<div class="head_left fl">
		<!--<img class="fl" src="images/login.png">-->
		<img class="fl" src="__PUBLIC__/images/ctlogo.png" style="margin-top: -12px;margin-left: -25px;">
	</div>
	<div class="head_right fr">
		<a href="#">
			<dl class="user">
				<dt></dt>
				<dd>个人中心</dd>
			</dl>
		</a>
		<a href="#">
			<dl class="shezhi">
				<dt></dt>
				<dd>系统设置</dd>
			</dl>
		</a>
		<a href="{:url('admin/index/logout')}">
			<dl class="exit">
				<dt></dt>
				<dd>退出</dd>
			</dl>
		</a>
	</div>
</div>
{/block}
{block name="body"}
<div class="main-box clearfix">
	<header class="main-box-header clearfix">
		<div class="pull-left">
			<h2>{$meta_title}</h2>
			<a class="btn btns" href="{:url('menupreview')}">预 览</a>
		</div>
	</header>
	<div class="main-box-body clearfix">
			<!-- 表格列表 -->
			<div class="table-responsive clearfix">
				<table class="table table-hover">
					<thead>
						<tr>
							<th width="120">菜谱计划</th>
							<th width="120">星期一 <span id="monday">{$monday|date='Y-m-d',###}</span></th>
							<th width="120">星期二 <span id="tuesday">{$tuesday|date='Y-m-d',###}</span></th>
							<th width="120">星期三 <span id="wednesday">{$wednesday|date='Y-m-d',###}</span></th>
							<th width="120">星期四 <span id="thursday">{$thursday|date='Y-m-d',###}</span></th>
							<th width="120">星期五 <span id="friday">{$friday|date='Y-m-d',###}</span></th>
							<th width="120">星期六 <span id="saturday">{$saturday|date='Y-m-d',###}</span></th>
							<th width="120">星期日 <span id="sunday">{$sunday|date='Y-m-d',###}</span></th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<th width="120"><span class="form-control" style="border:0">早餐</span></th>
							<th width="120">
								<div  class="cookCon" data='1,1' id="data1_1"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,1' id="vdata1_1" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='1,2' id="data1_2"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,2' id="vdata1_2" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='1,3' id="data1_3"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,3' id="vdata1_3" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='1,4' id="data1_4"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,4' id="vdata1_4" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='1,5' id="data1_5"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,5' id="vdata1_5" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='1,6' id="data1_6"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,6' id="vdata1_6" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='1,7' id="data1_7"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='1,7' id="vdata1_7" class="cookVal" value=""></div>
							</th>
						</tr>
						<tr>
							<th width="120"><span class="form-control" style="border:0">午餐</span></th>
							<th width="120">
								<div  class="cookCon" data='2,1' id="data2_1"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,1' id="vdata2_1" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='2,2' id="data2_2"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,2' id="vdata2_2" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='2,3' id="data2_3"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,3' id="vdata2_3" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='2,4' id="data2_4"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,4' id="vdata2_4" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='2,5' id="data2_5"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,5' id="vdata2_5" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='2,6' id="data2_6"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,6' id="vdata2_6" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='2,7' id="data2_7"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='2,7' id="vdata2_7" class="cookVal" value=""></div>
							</th>
						</tr>
						<tr>
							<th width="120"><span class="form-control" style="border:0">晚餐</span></th>
							<th width="120">
								<div  class="cookCon" data='3,1' id="data3_1"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,1' id="vdata3_1" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='3,2' id="data3_2"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,2' id="vdata3_2" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='3,3' id="data3_3"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,3' id="vdata3_3" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='3,4' id="data3_4"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,4' id="vdata3_4" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='3,5' id="data3_5"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,5' id="vdata3_5" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='3,6' id="data3_6"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,6' id="vdata3_6" class="cookVal" value=""></div>
							</th>
							<th width="120">
								<div  class="cookCon" data='3,7' id="data3_7"><div class="detail" style="width:70%;float:left;">暂无</div><div class="edit">编辑</div><input type="hidden" data='3,7' id="vdata3_7" class="cookVal" value=""></div>
							</th>
						</tr>
						
					</tbody>
				</table>
			</div>
			<!-- /表格列表 -->
			<div id="courseList" style="display:none;">
				
			</div>
			<div class="form-group">
				<div class="col-lg-offset-2 col-lg-10">
					
					<button class="btn btn-success submit-btn ajax-post">确 定</button>        
					<div class="btn btn-danger btn-return" onclick="javascript:history.back(-1);return false;">返 回</div>
				</div>
			</div>
		
	</div>
</div>

<div class="orderBox">
	<div class="orderInnerBox" style="height:auto;">
		<div style="font-size:20px;margin:20px; auto;text-align:center;">请选择菜品</div>
		<div  style="margin-top:20px;width:80%;margin-left:10%;background:#fff;display:inline-block;border-radius:8px;">
			<ul id="stulist">
				{volist name="cook" id="item"}
				{php}
				$images = get_cover($item['img']);
				{/php}
					<li data="{$item['foodname']}">
						<input class="stus regular-checkbox" id="checkbox{$item['id']}" type="checkbox" name="pid[]" value="{$item['id']}"/>
						<label for="checkbox{$item['id']}">
						<img class="foodimg" src="{:config('base_url')}{$images['path']}">
						<div class="fooddiv">{$item['foodname']}</div>
						</label>
					</li>
				{/volist}
			</ul>
		</div>
		<div style="font-size:20px;margin:0 auto;text-align:center;position:relative;margin:20px 0 20px 0;">
			<button class="sub" id="subs">确 认</button>
			<button class="cancelOrder" onclick="cancelOrder()">取 消</button>
		</div>
	</div>
</div>
<script>
$(function(){
	var sWeight = document.body.clientWidth;
	var sHeight = document.body.clientHidth;
	$('.orderBox').css('width',sWeight);
	$('.orderBox').css('height',sHeight);
	var cList = {$cList};
	console.log(cList);
	for(var i=0; i<cList.length;i++){
		$("#"+cList[i]['mark']).find('.detail').html(cList[i]['foodname']);
		$("#v"+cList[i]['mark']).val(cList[i]['cookId']);
	}
})
$(".submit-btn").click(function(){
	var totalArr = [];
	$(".cookVal").each(function(){
		var singelArr = [];
		if($(this).val() != ''){
			singelArr['mark'] = $(this).parent().attr('id');
			singelArr['cookId'] = $(this).val();
			var dayArr = $(this).attr('data').split(",");
			singelArr['mealtime'] = dayArr[0];
			switch(dayArr[1]){
				case '1' : singelArr['date'] = $('#monday').html(); break;
				case '2' : singelArr['date'] = $('#tuesday').html(); break;
				case '3' : singelArr['date'] = $('#wednesday').html(); break;
				case '4' : singelArr['date'] = $('#thursday').html(); break;
				case '5' : singelArr['date'] = $('#friday').html(); break;
				case '6' : singelArr['date'] = $('#saturday').html(); break;
				case '7' : singelArr['date'] = $('#sunday').html(); break;
			}
			if(singelArr){
				totalArr.push(singelArr);
			}
		}
		
	})
	if(totalArr.length>0){
		var json = {};
		for(var i=0; i<totalArr.length;i++){
			json[i] = {};
			for(var key in totalArr[i]){
		  	   json[i][key]=totalArr[i][key];
			}
		}
		totalJSON = JSON.stringify(json);
		
        $.post('{:url('foodplan')}',{cList:totalJSON}, success, "json");
        function success(data){

			if(data.code){
				$.messager.show(data.msg, {placement: 'center',type:'success'});
				setTimeout(function(){
					window.location.href = data.url;
				},2000);
			} else {
				$.messager.show(data.msg, {placement: 'center',type:'success'});
			}
		}
	}else{
		$.messager.show('请选择菜品', {placement: 'center',type:'warning',time:3000});
	}

	//console.log(totalArr);
});
$('.edit').click(function(){
	$thisIndex = $(this).parent().attr('id');
	$('#subs').attr('data',$thisIndex);
	$('.orderBox').show();
})
$('#subs').click(function(){
	var mark = $(this).attr('data');
	var cookSel = getCheckboxValue();
	var cookCheck = $('input[name="pid[]"]:checked');
	if(cookCheck.length<=0){
		$.messager.show('请选择至少一种菜品', {placement: 'center',type:'warning',time:3000});
		return false;
	}
	$('#'+mark).find('.detail').html(cookSel['title']);
	$('#v'+mark).val(cookSel['value']);
	//console.log(cookSel);
	$('.orderBox').hide();
})

function getCheckboxValue(){
	var chk_value = '';
	var chk_title = '';
	var cookSelected = [];
	$('input[name="pid[]"]:checked').each(function(){
		//alert($(this).siblings('label').children('.fooddiv').html());
		chk_value += ','+$(this).val();
		chk_title += ' '+$(this).siblings('label').children('.fooddiv').html();
	})
	cookSelected['value'] = chk_value;
	cookSelected['title'] = chk_title;
	return cookSelected;
}

function cancelOrder(){
	$('.orderBox').hide();
}

</script>
{/block}
{block name="script"}
{/block}